#!/usr/bin/env bash

set -ex

HERE="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
BASE_DIR=$(dirname $HERE)

# configure bot account
if [[ "$CI" == "1" ]]; then
  git config --global user.email "pelson.pub+conda-forge@gmail.com"
  git config --global user.name "conda-forge-admin"
  git checkout -b new_site_content
fi

# TODO:
# - Generate CFEP
# - Core and emeritus teams

# Build docusaurus site
npm install
npm run build

# Serve the announcements RSS feed in this old location too
# we can't redirect with the Docusaurus plugin, so just copy it
cp build/news/rss.xml build/docs/news.rss

echo "Built website! Preview at http://localhost:8000 with:"
echo "  python -m http.server -d build/"
